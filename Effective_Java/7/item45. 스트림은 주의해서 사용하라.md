

## item.45 스트림은 주의해서 사용해라

<br>


### Stream API?

- 자바8에서 추가된 다량의 데이터 처리 작업을 도와주는 api

- 컬렉션, 배열 등의 저장 요소를 하나씩 참조해서 함수형 인터페이스를 적용시켜 반복적으로 처리해줄 수 있는 기능을 가짐

- Stream: 데이터 원소 시퀀스

- Stream Pipeline: 원소들로 수행하는 연산단계

<br>


**최종연산**

> forEach(), findFirst(), anyMatch(), count(), collect() 등

- 스트림 파이프라인은 소스 스트림에서 시작해 종단 연산으로 끝나며 그 사이에 하나 이상의 중간연산이 있을 수 있다.

- 중간연산을 거쳐 최종연산을 통해 결과를 표시하는 것이다.

- 기본적으로 스트림 파이프라인은 `Lazy Evaluation` 되는데 이 `종단연산` 이 호출될 때 실제로 평가가 이루어진다.


<br>


**좋지만 항상 쓰라는 건 아님**

- 메소드 체이닝이 지원되어 단 하나의 표현식으로 결과를 만들 수 있으며 어떤 계산도 할 수 있지만

- 잘 쓰면 깔끔해지나 못 쓰면 더럽고 유지보수가 힘들어진다.

- 요약: 너무 스트림으로 다 쓰면 역효과, 적절히 알아볼 수 있게 쓰자

<br>


**람다 매개변수 이름을 주의하자**

- 람다에서는 타입 이름을 자주 생략하기에 매개변수 이름을 잘 지어야 스트림 파이프라인 가독성이 좋아진다.

<br>

**세부 구현이 복잡할 경우 스트림 로직 파이프라인 밖으로 빼낼 도우미 메소드를 잘 활용하자**

- 타입정보가 없거나 임시적인 변수를 자주 사용하기 때문에 일반 코드보다 스트림 파이프라인에서 가독성을 위해 중요성이 크다. 

<br>


**캐릭터 타입 처리에서는 스트림을 삼가자**

```java
"Hell".chars().forEach( v -> print((char) v));
```
기본적으로 스트림 내부 데이터 원소들은 객체 참조 또는 기본 `int` `double` `long` 타입만 지원한다.

위 처럼 char 타입을 활용해야만 할 경우 명시적인 형변환이 필요하며 성능적으로도 문제가 발생할 수 있다.

<br>


**Stream 이 부적절한 경우**

- 가독성과 유지보수를 해칠 정도로 복잡한 경우

- 함수객체로 할 수 없지만 코드블록으로 할 수 있는 일을 해야만 하는 경우

> 코드블록 스코프에서는 내부 final 이 아닌 지역변수가 가변하지만 람다 표현 안의 변수는 사실상 final 이라 지역변수 수정 불가

> 코드블록에서는 반복 시 return,break 등의 처리나 검사 예외를 던질 수 있지만 람다 표현에서는 불가능하다.

<br>

**Stream 이 적절한 경우**

- 원소들의 시퀀스를 필터링하거나 **일관되게 변환** 한다.

- 원소들의 시퀀스를 하나의 연산을 사용해 결합한다(sum, min 등)

- 원소들의 시퀀스를 컬렉션에 모은다.

- 원소들의 시퀀스에서 특정 조건을 만족하는 원소를 찾는다.

<br>

**스트림이 순회에서 For-Loop 보다 의미가 있는 경우?**

- Collection이 되는 스트림 소스의 크기가 충분히 크거나 내부 컴퓨팅 연산 비용이 매우 클 때

- 기본타입의 베이직한 순회는 오래 사용된 형태로 컴파일러 최적화가 잘 되어있어 스트림 사용보다 훨씬 효율적일 수 있다.




**Stream으로 하기 어려운 것**

데이터가 파이프라인의 여러 단계를 통과할 때 이 데이터의 각 단계에서의 값들에 동시에 접근하는 것

- 스트림 파이프라인은 한 값을 다른값에 매핑하고 나면 원래의 값은 잃는 구조이다.

- 다른 객체를 사용해 매핑하는 방법도 있으나 목적에서 벗어나며 지저분해진다.


<br>


**요약**

스트림 사용 시 멋있어질 처리가 있고 아닌 경우가 있다.

둘을 적절히 조합하여 해결할 경우 대부분 이상적이다.

따로 룰이 있는 것은 아니지만 스트림 방식이 나아보이고 협업자들이 이해하고 선호한다면 사용하자

확신이 서지 않는 다면 스트림과 반복 두가지를 모두 해보고 나은 쪽을 선택하라.

