


### item 67. 최적화는 신중하게 하라


<br>


**책에 기재되어 있는 명언을  인용**

> 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다. (심지어 효율도 올리지 못하면서)

> 자그마한 효율성은 모두 잊자. 섣부른 최적화는 만악의 근원이다.

> 최적화 규칙을 알려주겠다. 첫째 - 하지마라.  둘째 - 아직하지마라


<br>

섣부른 최적화 시도는 좋은 결과보다는 해로운 결과를 낳고 더 빠르지도 않고 제대로 동작하지 않으면서 수정은 어려운 소프트웨어를 만들 가능성이 있다.

성능 때문에 견고한 구조를 희생하지 말자. 

**빠른 프로그램보다는 좋은 프로그램을 작성하자**

<br>

좋은 프로그램은 정보 은닉 원칙 하에 설계되었을 것이기에 다른 요소의 변경 없이 독립적으로 재설계 할 수 있을 것이며

좋은 프로그램이나 성능이 나오지 않는다면 아키텍쳐 자체가 최적화의 길을 안내해줄 것이다.


<br>

완성할 때 까지 성능을 무시하라는 건 아니며 아키텍쳐의 결함이 성능을 제한하는 상황이라면 시스템 전체를 뒤엎어야 할 가능성이 높기 때문에 지양하라는 것 같다.

구현상의 문제는 좋은 소스코드를 작성했다면 충분히 추후에 최적화하여 해결할 수 있을 것이다.

<br>

<br>

### 성능을 위해 설계에서 염두할 것

<br>

**성능을 제한하는 설계를 피하자**

- 완성 후 변경이 어려운 설계 요인은 컴포넌트끼리나 외부와 소통하는 그 방식이다.

- API, 데이터 포맷, 네트워크 프로토콜이 예이다.

- 이런 요소들은 완성 후 변경이 어렵기 때문에 시스템 성능을 제한할 수 있다.



<br>

**API 설계 시 성능에 주는 영향을 고려하자**

- `public` 타입을 가변으로 만들어 내부 속성을 변경가능하게 만들면 불필요한 방어적 복사를 유발할 수 있다.

- 불필요한 상속 설계한 public 클래스 또한 상위 클래스에 영원히 종속되어 성능 제약을 물려받을 수 있다.


> 책에서 다룬 java.awt.Component 클래스를 살펴보았다.


```java
    public Dimension getSize() {
        return size();
    }

    /**
     * @deprecated As of JDK version 1.1,
     * replaced by <code>getSize()</code>.
     */
    @Deprecated
    public Dimension size() {
        return new Dimension(width, height);
    }
```  

이 클래스의 `getSize()` 메소드는 `Dimension` 인스턴스를 반환하는데 getSize를 호출하는 모든 곳에서 이 인스턴스를 새로 생성하게 된다.

아주 많은 요청이 발생했을 때 비효율적일 것이다.


```java
    public int getWidth() {
        return width;
    }
```

Dimension 을 불변으로 만드는 방법이 있지만 해당 클래스에는 Deprecated 된 기존 size 메소드 대신 Dimension 객체의 기본 타입을 따로 반환할 수 있게 끔 메소드를 구현했다


<br>

**하지말던가 최적화 시도 전후 성능을 측정하자**

- 잘 설계된 API는 성능도 좋은 게 보통이며 성능을 위해 API를 왜곡하는건 좋지 않은 생각이다.

- 대부분 최적화 전후 성능을 비교했을 때 눈에 띄게 성능을 높이지 못하는 경우가 많다고 한다.

- 느릴거라 기대했던 부분이 사실은 성능에 무관할 수 있는 상황이 발생하여 시간을 낭비하게 된다.

- **프로파일링 도구** 를 사용해 최적화 노력을 어디에 집중해야 할지 찾아 개선하자

<br>

자바는 사람이 작성하는 코드와 CPU 연산 명령 사이의 추상화 차이가 커 최적화 성능 변화를 일정하게 예측하기 힘들다.

C와 C++ 에 비해 성능 모델이 정교하지 않고 연산에 필요한 상대적 비용이 명확하게 정의되어 있지 않다. 


<br>

또한 자바의 성능모델은 구현 시스템, 릴리즈, 프로세서, 가상머신, 라이브러리마다 차이가 있다.

여러 자바 플랫폼이나 여러 하드웨어에서 돌린다면 최적화의 효과를 그 각각에서 확인해야 한다.


<br>

### 요약

- 빨라지려고 하지말고 좋은 프로그램을 작성하자

- 하지만 시스템 설계 시 API, 네트워크 프로토콜, 영구 저장 데이터 포맷 설계시에는 성능을 염두하자

- 시스템 구현 후 성능을 테스트해 적절하면 된 것이다.

- 그렇지 않을 경우 프로파일러를 사용해 원인을 찾고 최적화하자



