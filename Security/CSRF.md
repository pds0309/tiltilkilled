

## What is CSRF?


**CSRF (Cross-Site Request Forgery) : 사이트 간 요청 위조**

- 웹 애플리케이션 취약점 공격의 하나이다.

- **사용자 자신의 의지와 상관없이 공격자가 사용자의 권한을 도용해 의도한 행위를 웹 애플리케이션에서 하게끔 만들어 서버를 공격하는 것**

- 특정한 웹 애플리케이션이 이용자의 브라우저를 신뢰하고 있을 때에 대한 공격이다


<br>


### 공격 과정

1. 사용자의 브라우저에 공격자가 원하는 사이트에 대한 인증이 되어있다.

2. 사용자가 공격자가 만든 덫(피싱 사이트, 메일 등 )에 걸려 서버에 위조된 요청을 하게 된다.

3. 공격자가 의도한 사용자가 의도하지 않은 응답이 서버에서 발생한다.

<br>

### 공격 방법

- `img` 태그의 url 을 이용해 간단하게 `GET` 요청을 할 수도 있고 `form` 태그를 삽입해 `POST` 요청도 할 수 있을 것이다.

- 피해자의 인증 정보를 이용해 피해자의 계정 정보를 변경한다던지 광고글을 작성한다던지 하는 행위를 할 수 있다. 피해자가 사이트의 관리자라면 치명적일 것이다.


<br>

### 대응 방법

**Referrer Check**

- 요청 Header 의 referrer 값을 체크해 동일 도메인 출처인지 검증 후 비인가 처리 할 수 있다.

- 사이트 내 `XSS` 취약점 존재를 배제하면 외부에 존재하는 악의적인 위조 요청으로부터는 방어가 된다.

<br>


**로봇이세요?**

- CAPCHA 를 사용하면 이미지 확인, 체크 등의 행동 없이는 요청을 거부시킬 수 있다.

<br>

**Use CSRF Token**

- 서버에서 사용자의 세션에 token 을 저장해두고 매 요청마다 그 값을 포함해 전송한다.

- 사용자가 요청할 때 이 token 값이 같이 서버로 전송되어야 하고 세션의 token 과 비교해 일치여부를 확인하여 위조여부를 판단한다.

- XSS 취약점을 활용한 CSRF 공격에는 역시 취약할 것이다.

- 스프링 시큐리티 사용시 기본적으로 활성화 되어 POST, PUT 등의 요청에 csrf 토큰 값이 포함되어있어야 응답에 성공한다
 