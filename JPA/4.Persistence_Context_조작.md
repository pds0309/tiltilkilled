

## 영속성 컨텍스트 조작하기


### Flush

- 영속성 컨텍스트의 변경 내용을 DB에 반영(동기화)하는 것이다.

**플러시 방법**

1. `em.flush()` 직접 호출

2. 트랜잭션 커밋 시 플러시 자동 호출됨

3. `JPQL` 쿼리 실행 시 플러시 자동 호출됨



<br>

## 준영속

### 준영속 상태 특징

**비영속 상태에 가까움**

- 1차캐싱, 쓰기지연, 변경감지, 지연 로딩 등 어떤 기능도 동작 안함

**식별자는 가지고 있다**

- 한번 영속상태일 때 얻어왔기 때문에 가지고 있음.




### Detach

- 엔티티를 준 영속 상태로 전환한다.
	- 준영속상태: 영속성 컨텍스트가 관리하지 않는 상태

- `detach` 하면 `1차 캐시`부터 `SQL 쓰기지연 저장소`까지 해당 엔티티를 관리하기 위한 모든 정보가 제거된다.

<br>

### Clear

- `detach` 가 하나의 엔티티를 준영속 상태로 만들었다면 `clear` 는 영속성 컨텍스트 자체를 초기화 해 모든 엔티티를 준영속 상태로 만드는 것

<br>

### Merge

- 준영속 상태의 엔티티를 다시 영속 상태로 변경한다.

- 준영속 상태의 엔티티를 인자로 받아 새로운 영속 상태의 엔티티를 반환한다.

- 비영속 엔티티 또한 영속 상태로 만든다.

