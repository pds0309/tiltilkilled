


### What is LoadBalancing?


클라이언트는 다수고 서버는 하나라면 요청이 몰려 네트워크와 서버에 부하가 심해진다.

이를 분산해주는 작업을 로드밸런싱이라고 한다.

<br>


**L4 Switch**

- 로드 밸런싱을 해주는 장비

- IP주소 및 TCP/UDP `포트정보` (`Transport Layer`)를 참조하여 스위칭

- 클라이언트로부터 요청을 로드 밸런서에서 받아 최적의 서버로 요청하고 클라이언트에 응답

- 하드웨어 기술로 비싸다. 현재는 MSA 등에서 L7, ELB, Nginx, HaProxy 등의 소프트웨어를 많이 사용

<br>

**L7 Switch**

- Application Layer 를 사용하며 URL 또는 HTTP 헤더에서 부하 분산이 가능하다.

- `IP`, `Port` 이외에도 `URI`, `Payload`, `Http Header`, `Cookie` 등 내용을 기준으로 부하 분산하기 때문에 `콘텐츠 기반 스위칭` 이라고도 한다


<br>

**L4 vs L7??**

- L4 는 단지 부하 분산의 목적

- L7은 여러 서비스에 대한 요청을 각 서버에 분산할 수 있는 것

<br>

![1241](https://user-images.githubusercontent.com/76927397/172525474-798ff30b-dcf4-4a44-8fcb-e936f90222b2.png)

<br>


### AWS NLB vs ALB

- 몇 계층에서 분산작업을 수행하느냐에 따라 다르다.


**Network LB**

- L4

- 클라이언트 IP와 서버 사이에서 서버로 들어오는 트래픽만 로드 밸런서를 통하는 방식

- 클라이언트의 요청에 대한 서버의 응답 전 액세스 제한 가능

<br>

**Application LB**

- L7

- Reverse Proxy 대로 클라이언트 IP와 서버사이의 인아웃 트래픽 모두 로드밸런서를 통하는 방식

<br>


### 로드밸런싱 알고리즘

**RR**

- 순서대로

**가중 RR**

- 서버마다 가중치 매겨서 처리

**IP Hash Method**

- 클라이언트의 IP주소를 특정 서버로 매핑하여 요청 처리
- 사용자의 IP를 해싱해 항상 같은 사용자가 동일한 서버로 연결되게끔 해주는 것을 보장한다.

**최소 연결 방식**

- 가장 연결이 적은 곳으로 배분

**최소 응답**

- 서버 연결상태와 응답시간 고려해 트래픽 배분





