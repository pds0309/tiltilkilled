


### 교착상태

- 교착 상태란 프로세스가 자원을 얻지 못해 다음 처리를 하지 못하는 상태.

- 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 서로가 서로를 기다리게 되어 발생


![os4](https://user-images.githubusercontent.com/76927397/163706696-bbf016db-2168-4f40-8160-d4755862f86e.JPG)


위 이미지에서 프로세스 1과 2는 리소스 1,2 가 모두 필요하다고 했을 떄

한 쪽에서 먼저 자원을 모두 점유하여 작업을 수행하지 못하고 무한정 기다리는 상태가 되어버린다.

<br>


### 교착 상태 발생 조건

다음 4가지 조건이 모두 갖추어졌을 때만 교착상태가 발생할 수 있다.

**상호배제**

- 한 번에 한 개의 프로세스만이 공유 자원을 사용할 수 있어야 한다.

**점유와 대기**

- 최소한 하나의 자원을 점유하고 있으면 다른 프로세스에 할당되어 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다.

**비선점**

- 다른 프로세스에 할당된 자원은 사용 종료 전 까지 강제로 뺏을 수 없다.

**순환 대기**

- 공유자원과 공유 자원을 사용하기 위해 대기하는 프로세스들이 원형으로 구성되어있어 자신에게 할당된 자원을 점유하면서 앞이나 뒤에 있는 프로세스 자원을 기다려야 한다.

<br>

### 교착 상태 해결하기

**예방**

- 4가지 조건 중 하나를 제거하는 것

- 상호 배제 부정
	- 여러 프로세스가 공유 자원을 사용할 수 있다.

- 점유 대기 부정
	- 프로세스가 실행되기 전 필요한 모든 자원 할당

- 비선점 부정
	- 다른 프로세스의 점유 자원을 뺏을 수 있다.

- 순환 대기 부정
	- 자원에 고유번호를 주고 번호 순서대로 자원을 요구하게 한다.

**회피**

- 교착 상태가 일어나면 피하는 방법

- 프로세스에게 자원을 할당할 때 안전한지 아닌지 결정하고 안전할 때만 할당하는 방법

**탐지 및 회복**

- 교착상태 발생을 허용한 다음 회복하는 방법

- 교착 상태가 제거될 때 까지 한 프로세스씩 중지시키거나 교착 상태의 프로세스를 모두 중지하거나 교착 상태 프로세스가 점유한 자원을 다른 프로세스에게 할당해 일시 중지 시킬 수 있다.


<br>

### 식사하는 철학자 문제

[ref](https://namu.wiki/w/%EC%8B%9D%EC%82%AC%ED%95%98%EB%8A%94%20%EC%B2%A0%ED%95%99%EC%9E%90%20%EB%AC%B8%EC%A0%9C)


n명의 철학자가 원형테이블에 앉아 있고 n개의 포크가 있다고 했을 때

철학자들은 식사를 하려면 양 옆의 포크 두개를 잡아야만 한다고 할 때 

모든 철학자가 왼쪽의 포크를 먼저 집고 난 뒤에 오른쪽 포크를 집으려고 할 때 데드락이 발생할 수 있다.(자기 오른쪽에 포크가 없다)

모든 철학자들이 오른쪽 포크를 기다리고 있어 굶어 죽게 된다.

> 상호배제 : 철학자들은 서로 포크를 공유할 수 없다.

> 비선점 : 철학자가 다른 철학자의 포크를 빼앗을 수 없다.

> 점유 대기: 왼쪽 포크를 먼저 잡고 오른쪽 포크를 기다리고 있다.

> 원형대기: 원형테이블에 앉아있다. (마지막 철학자는 첫번째 철학자 기준 왼쪽에 있는 포크가 필요함)


**해결하기**

- ~~손으로 먹는다~~

- 누군가 한명이 반대 포크를 먼저 들게끔 한다.

- 두 개의 포크를 모두 잡을 수 있을 때만 잡게 한다.

- 포크 수가 더 많아지면 된다.

- 포크에 구요한 우선순위를 부여해 순서대로 포크를 집게 만든다.

- 한 쪽 포크를 더 얻는데 일정시간 실패하면 있던 포크를 반납하게 한다.

