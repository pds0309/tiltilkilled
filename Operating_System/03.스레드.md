


## 스레드

<br>

### 스레드란?

**프로세스 내에서 실제로 작업을 수행하는 주체의 단위를 말한다**

- 모든 프로세스에는 한 개 이상의 스레드가 존재하여 작업을 수행한다.

- 프로그램 환경에 따라 둘 이상의 스레드를 동시에 수행할 수 있다.(Multi-Thread)

- 하나의 프로세스에 존재하는 스레드들은 **코드, 데이터, 힙 영역과 같은 메모리 자원을 공유**한다.

- 제어정보, 지역정보, 스택영역이 독립적으로 할당된다.

<br>

--- 

잠깐! 어제 건너 뛴 프로세스의 메모리 구조에 대해 알아보자

### 프로세스의 메모리 구조

**Code 영역**

- 컴파일된 소스 코드가 저장되는 영역


**Data 영역**

- 전역 변수, Static 변수들이 위치하는 공간


**Heap 영역**

- 동적 할당을 위한 메모리 영역
- 런타임 시 필요한 정보들이 할당된다.(`EX: 자바의 new 연산자를 통해 생성된 인스턴스`)

**Stack 영역**

- 지역변수, 파라미터 등이 위치하는 공간
- 복귀주소(재귀 같은), 로컬변수, 매개변수, 리턴 값 등의 정보가 할당된다. 

---

<br>

### 스레드의 구조

- **하나의 프로세스**에 존재하는 **스레드들**은 힙,데이터,코드 영역을 공유하고 제어정보,지역정보,스택영역은 독립적으로 할당되는 구조다

- 각 스레드들간의 독립적인 실행 흐름을 위해 독립적인 함수 호출이 보장되어야 해서 스택영역은 스레드마다 독립적으로 할당되는 것이다. 	


<br>

### 스레드 풀

- 매번 생성, 소멸 요청에 대해 스레드를 생성, 소멸하는 것이 아니라 일정 개수만큼 미리 생성해두는 것이다.

- 급격하게 많은 양의 작업이 요청되어도 스레드 개수가 급격하게 늘어나거나 하지 않아 시스템에 안정성을 준다.

- 그렇다고 너무 많이 만들어놓으면 당연히 메모리 낭비이기 때문에 적절한 스레드 수를 잘 고려해야 할 것 같다.



<br>

### 먼저 멀티 프로세스는??

![os03_2](https://user-images.githubusercontent.com/76927397/163320884-f98032c0-be01-47bc-853a-480429ae99c6.jpg)


- 여러개의 CPU를 사용하여 여러 프로세스를 `동시적으로` 수행하는 것을 말한다.




### 멀티스레드

![os03](https://user-images.githubusercontent.com/76927397/163320862-8c7b43f3-f287-4662-bd30-12d2a35820e2.jpg)


- 하나의 프로세스를 다수의 실행 단위(스레드)로 구분하여 `동시적으로` 실행하도록 하는 것

**멀티스레드의 장점**

1. 각 스레드가 자신이 속한 프로세스의 메모리를 공유하기 때문에 시스템 자원의 낭비를 줄일 수 있다.
2. 하나의 스레드가 작업하면서 동시에 다른 스레드가 별도의 작업을 할 수 있기 때문에 사용자와의 응답성도 개선이 된다.


**멀티스레드의 단점**

1. 둘 이상의 스레드가 동시에 실행되며 공유자원에 동시에 접근할 때 의도치 않은 읽기나 수정 동작을 야기할 수 있다.
	- 동기화가 필요하다.

2. 동기화를 통해 스레드 작업 처리 순서와 공유자원에 대한 접근을 컨트롤할 수 있지만 불필요한 동기화 시(`EX: Java synchronized keyword`) 과도한 `락`으로 병목현상을 발생시켜 성능이 저하될 수 있다.

3. CPU 코어 수가 적을 때(싱글코어)의 멀티 스레딩은 스레드 생성시간이 오히려 오버헤드로 작용해 단일 스레드보다 부적절할 수 있다.



<br>

## VS 놀음하며 복습

### 멀티스레딩 vs 멀티 프로세싱

- 멀티 스레드는 하나의 프로세스 내부의 여러 작업단위를 말하며 적은 메모리 공간을 차지하고 `문맥교환` 이 빠르다.
	- 동기화 문제를 해결해야 하고 하나의 스레드 종료 시 다 같이 종료될 수 있다.

- 멀티 프로세스는 다수의 CPU 를 사용해 여러 프로세스를 동시에 수행하는 것으로 하나의 프로세스가 디져도 다른 프로세스의 동작과는 독립적이다.
	- 많은 메모리 공간을 차지하고 CPU 점유 시간을 많이 차지한다.
 

### 스레드 VS 프로세스

**프로세스**

- 프로세스는 `실행중인 프로그램` 이라고 할 수 있다.

- 각 프로세스는 독립 메모리 영역을 가져 다른 프로세스와 독립적이다.

**스레드**

- 스레드는 프로세스 내부에서의 실행 단위로 메모리 영역의 스택 영역을 제외하고 서로 자원을 공유한다.


<br>

**TODO**

자바 스레드 관련 공부하고 내용 추가

