

## Const

> 변수를 선언할 때 사용되며, 한 번 할당된 값을 변경할 수 없게한다.

```javascript
const a = 1;
a = 5; // Cannot assign to 'a' because it is a constant.
```

<br>


## const로 할당된 객체의 요소를 왜 변경하거나 추가할 수 있을까

이는 `객체`라는 것이 어떻게 변수에 할당되고 어디에서 관리되는지를 생각해보아야 한다.

```javascript
function inc(a: number) {
  a++;
  console.log(a);
}

let a = 1;
inc(a); // 2
console.log(a); // 1

function addEle(arr: number[], a: number) {
  arr.push(a);
  console.log(arr);
}
let ar = [1,2,3];
addEle(ar, 4); // [1,2,3,4]
console.log(ar); // [1,2,3,4]
```

**객체는 변수에 할당될 때 내부 요소가 아닌 '참조(주소)'가 할당된다.**

```javascript
let a = [1];
let b = [1];
let c = a;
a === b; // false
a === c; // true
```

`const`라는 키워드로 재할당을 할 수 없게 객체를 선언/할당해도 실제로 할당된 것은 주소값이다.

java의 `힙 영역` 같은, 주소에 대응되는 객체의 내부 값들이 저장되는 메모리 영역에 실제 값이 있으며

사용할 때는 이 메모리 주소를 가져와 사용한다.

```javascript
const a = [1];
const b = a;
a.push(5);
console.log(b); // [1, 5];
```

> 위의 예시에서 `b`는 `a`라는 배열을 가지는 객체의 `주소`가 할당된 것으로 같은 주소를 가진다. => 같은 값을 가리킨다.

**그래서 왜 변경이 가능한가**

결국 `const`로 할당된 객체의 주소 그 자체는 변경될 수 없지만 주소가 가리키는 값은 그렇지 않다.

할당된 주소가 참조하는 내부 값을 변경하는 것이라 가능하다.

맨 위 예시의 함수 인자로 넘길 때에도 결국 가진 `값`을 복사해 넘기게 된다.

함수 스코프에 복사된 값을 가져와 함수호출스택에 넣고 조작하며 함수 스코프가 끝나면 모두 pop되며 복사된 값은 생명주기를 잃는다.

따라서 기본타입인 숫자를 인자로 넘겨도 상위 스코프의 할당된 값은 변경되지 않는다.

객체도 마찬가지로 인자로 주소값을 복사해 넘기며 동작하는 방식은 같지만 주소가 참조하는 내부 값을 조작하고 생명을 잃는 것이며 해당 주소는 상위스코프에 이미 참조되어 사용되고 있다.


<br>

**불변객체로 사용하기**

`Object.freeze()`메소드를 활용해 내부 값 또한 한번 생성되면 더 이상 변경할 수 없게 만들 수 있다.

한번 만들어지고 불변성이 보장되면서 사용되어야 하는 경우 안전함을 보장한다.

```javascript
const obj = {
    a: 'hello',
    b: 'c'
}
obj.b  = '5';

const freezedObj = Object.freeze({
    a: 'hello',
    b: 'c'
});
freezedObj.b = '6'; // Cannot assign to 'b' because it is a read-only property.
```

<br>

**리액트에서의 객체**

상태로 객체를 관리할 때 불변성을 유지하라고 한다.

여기서 불변성을 유지하라는 것은 상태로 관리하는 객체의 내부 값만 변경하지 말라는 것이다.

내부 값을 변경해도 할당된 주소는 변경되지 않으며 리액트에서 상태의 변경을 감지할 때 이전 스냅샷과 현재에 대한 `얕은비교(객체 주소 비교)`를 수행하기 때문이다.

기본타입이야 직접 값을 수정할 수 없지만 객체 형태를 관리할 때는 개발자가 의도하여 불변성을 지켜야 한다.

객체가 참조하는 주소의 내부 값은 불변하지 않기 때문이다.

따라서 상태를 업데이트할 때 현재 객체를 복사해 새로운 주소값을 가지도록 하여 업데이트되게끔 해야한다.



