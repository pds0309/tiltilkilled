
<br>

### 메시징 서비스란?

- 비동기로 메시지를 송수신 할 수 있게 해주는 서비스

- 로그 데이터, 이벤트 메시지 등 소프트웨어 간 메시지 전달을 통한 데이터 교환

<br>

**메일 서버 예시**

- 송신자가 메일을 보내면 메일 서버에 저장된다.

- 수신자는 원하는 시점에 메일 서버로부터 받은 특정 메일을 계속 확인할 수 있다.

<br>

![image](https://user-images.githubusercontent.com/76927397/172966182-2b4cf633-08db-4714-ae94-fcf8b6b145b0.png)

<br>

### Apache Kafka

- 아파치에서 개발한 오픈 소스 `메시지 브로커` 서비스

- 실시간으로 대규모, 대용량 기록(메시지 데이터) 스트림을 게시, 구독, 저장 및 처리할 수 있는 분산 데이터 스트리밍 플랫폼이다.

- 큐 구조

- `Topic` 단위로 메시지가 저장되고 소비됨



<br>

### 왜 나옴?

- 실시간 처리에 능하다.

- 모든 시스템에 데이터 전송이 가능하고 서비스 확장에 용이함.

- 기존 네트워크 방식 단점 극복

> **수신자 개체가 빠지거나 수신 불능**이 되어도 메시징 시스템이 살아있으면 전달한 메시지가 유실되지 않음


**메시징 시스템 없이 직접 연결하기?**

일반적 네트워크 방식에서는 **송,수신자의 상태에 따라 장애처리를 해줘야하고 참여 개체가 늘어날 때의 추가 작업**이 필요하다.

> N:M 으로 연결이 결합되어 있기 때문에 한 쪽이 늘어나면... 

메시징 시스템은 직접 소비자와 생산자를 연결하여 메시지를 전달 하는 것 보다 메시지 전달 속도가 느리고 구현이 어려울 수 있으나 안정적이고 확장성에 좋다.






<br>

### KafKa 구조

<br>

![image](https://user-images.githubusercontent.com/76927397/172968111-fd0981e5-14f7-4438-9010-7fbe849ec90a.png)

![image](https://user-images.githubusercontent.com/76927397/172968762-e04cd84f-aabd-4504-bd18-51f6b18018d2.png)

<br>

**zookeeper에서 관리**

- 카프카 동기화, 메타데이터 저장, 상태관리, 컨슈머와의 통신 관리

- 분산 애플리케이션이 안정적으로 동작할 수 있도록 분산된 애플리케이션 정보를 집중하고 관리, 동기화 해줌




[추후 확인해볼 것 - 카프카에 주키퍼 빠진다.](https://www.itworld.co.kr/news/235784)


**pub/sub 모델 기반**

> 중앙에 메시징 시스템 서버가 있고 그 서버를 이용해 메시지를 보내고 받는 형태의 통신을 말함

- Kafka 서버(9092)(메시지 브로커) 는 `토픽` 단위로 메시지를 저장

> 토픽은 메시지그룹, 생산자 소비자가 자신들의 메시지를 구분하기 위한 이름으로 사용하며 여러 생산자 소비자가 접근 가능
	
- 내부에는 `파티션` 들로 토픽이 나뉘어지어 병렬처리가 가능하고 많은 메시지를 처리할 수 있다.
 
- 객체 pub 시 기본적으로 `직렬화` 되어 큐에 저장되고 sub 시 `역직렬화` 되어 소비된다.

<br>

**동작 요약**

(1) 프로듀서가 새로운 메시지를 카프카로 보낸다.

(2) 프로듀서가 보낸 `메시지`는 카프카 큐(토픽-식별자)에 도착해 저장된다.

(3) 카프카 서버에 접속하여 컨슈머가 메시지를 가져간다.

- 구독을 신청한 컨슈머만 메시지를 전달 받을 수 있다.

<br>

### 특징

**멀티 프로듀서, 멀티 컨슈머**

- 하나의 토픽에 여러 프로듀서, 컨슈머가 접근 가능하고 이를 위해 카프카는 중앙 집중형 구조로 구성

<br>

**디스크에 메시지 저장**

- `RabbitMQ` 등 기존 메시징 시스템의 경우 컨슈머가 읽어가면 큐에서 바로 삭제

- 카프카는 메시지 보관 주기동안 디스크에 저장하여 트래픽 폭주 등으로 인한 메시지 손실 방지됨

- OS의 `페이지 캐싱` 을 사용하기 때문에 빠르고 메모리를 많이 사용한다. (카프카 서버에 다른 app 함께 실행 권장 x)

<br>

**확장성**

- 분산 시스템 기반 설계

> 분산 시스템 구성, 복제가 쉽고 하나의 서버에서 장애 발생 시 다른 서버가 처리	

- 많은 수의 메시지 브로커로 확장 가능(초기에는 1개의 카프카에 대해 3개의 클러스터로 시작)

<br>


